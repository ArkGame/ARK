sudo: required
dist: trusty
language: cpp

env:
  global:
    - LANG="en_US.UTF-8"
    - COVERAGE=false

compiler:
  - gcc

# need gcc 4.9 and cmake
os:
  - linux
addons:
  apt:
    sources:
      #- ubuntu-toolchain-r-test
      - george-edison55-precise-backports
    packages:
      #- g++-4.9
      - cmake-data
      - cmake
      - lcov
  #sonarcloud
  sonarcloud:
    organization: "ark-game"
    token:
        secure: "Pmr9IJ7I1DNsQ7bGlpVwTR0WlEkOF8JwWTqEhGJLWBk7Ca6jWGoDljy1z0K24auwWlyh6tjpsLnTjSrPxEGalcyQqGOuTZW+L2bmJr17bHfwWhBbJZTIkOy21+z9Cg+Q6zbQ5/LHQGb6ihv8t6/P4UAKk4hHVCxy+o/YI0A807gOpdFwFqxGvtFod/G6pM62wjBd+HRlp98/4O81vi49H5QV0Ss7t+UeqtkBuAE0Tpp9tpqlXu3KTFcZt/EFGG8EYfMD2Ycli8X2XtBhdKnRfJk53TI4fzaPZLwMibNuxGccCdix5kTVGL19CaTGm3X+9w6OnF15QBgEL/jpamnzP/xirb1MC+0x2+sh9oxOskzWznfoWlAt57/tV9ukqbjKyclz7j8JfZ7IRIAmxdG1IAAc8w670TxjdSUsW2lVccIKIUa85Zv0pEIBps/fy+W2u3Z+2jVyPbQE6RBbjXivQ6AvKd9MATDpBo336ib0/Glto4SXrrM8m/FW35vT8VS1b5phVaqoytbRMhPBlZgGjaBY8nwTrIutI2hkRY2XE0rOxglU1o8nVCwsH4JM2c7xBtancaGoDO7PzezVgKX5TV9No7qkAFIe6KfCArVw0Nxw8bKn0/fKCPK2DWiU17yOyqM0qOJiZqK0ZgpJCct7D5IjNKVPvK+69pCd0VdNRJM="
before_install:
  # run build_dep.sh
  - pwd
  - cd Dep
  - chmod -R 755 build_dep.sh
  - ./build_dep.sh
  - cd ..

install:
    #- sudo pip install --upgrade pip
    #- sudo pip install codecov
  
before_script:
  # cmake
  - if [-d "build" ]; then rm -rf build; fi
  - mkdir build && cd build
  - cmake -G "Unix Makefiles" -DENABLE_COVERAGE=ON ..

script:
  # make
  - make -j 8
  - echo $TRAVIS_BUILD_DIR/Frame
  - cd $TRAVIS_BUILD_DIR/Frame
  - build-wrapper-linux-x86-64 --out-dir bw-output make clean
  - sonar-scanner -X
    
after_success:
  #- bash <(curl -s https://codecov.io/bash)
  
cache:
  directories:
    - '$HOME/.sonar/cache'

notifications:
  email:
    - nickyang1988@qq.com
    - 410274624@qq.com
